#!/usr/bin/env node

const fs = require("fs")
const path = require("path")
const { version } = require("../package.json")
const { Program } = require("./program").Elm

const json = { simpleKey: "simple value" }
const program = Program.init({
  flags: {
    argv: process.argv,
    versionMessage: version,
    json,
  },
})

program.ports.writeFile.subscribe((file) => {
  fs.writeFileSync(
    path.join(...file.path) + ".elm",
    file.content,
    console.error
  )
})

program.ports.printAndExitFailure.subscribe((message) => {
  console.log(message)
  process.exit(1)
})

program.ports.printAndExitSuccess.subscribe((message) => {
  console.log(message)
  process.exit(0)
})
